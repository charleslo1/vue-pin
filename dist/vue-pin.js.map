{"version":3,"file":"vue-pin.js","sources":["../src/utils.js","../src/Pin.js","../index.js"],"sourcesContent":["/**\n * 包裹 DOM 元素\n * @param  {HTMLElement} el      被包裹元素\n * @param  {HTMLElement} wrapEl  包裹元素\n */\nexport const wrap = (el, wrapEl) => {\n  let wrapper = wrapEl || document.createElement('div')\n  el.parentNode.insertBefore(wrapper, el)\n  el.parentNode.removeChild(el)\n  wrapper.appendChild(el)\n}\n/**\n * 取消包裹 DOM 元素\n * @param  {HTMLElement} el      需要取消包裹的元素\n */\nexport const unwrap = (el) => {\n  Array.prototype.forEach.call(el.childNodes, (child) => {\n    el.parentNode.insertBefore(child, el)\n  })\n  el.parentNode.removeChild(el)\n}\n\n/**\n * 获取样式\n * @param  {HTMLElement} el  DOM 元素\n * @param  {String}      key 样式键（可选）\n * @return {String/Object}   样式值/样式表\n */\nexport const getStyle = (el, key) => {\n  let styles = el.ownerDocument.defaultView.getComputedStyle(el, null)\n  if (key) return styles[key]\n  return styles\n}\n\n/**\n * 设置样式\n * @param  {HTMLElement} el     DOM 元素\n * @param  {Object}      styles 样式表\n */\nexport const setStyle = (el, styles) => {\n  let value = null\n  for (let key in styles) {\n    value = styles[key]\n    if (typeof value === 'number') {\n      value = [value, 'px'].join('')\n    }\n    el.style[key] = value\n  }\n}\n\n/**\n * 获取元素 offset\n * @param  {HTMLElement} el DOM元素\n * @return {Object}         offset 值\n */\nexport const getOffset = (el) => {\n  if (!el) return {top: 0, left: 0}\n  let box = el.getBoundingClientRect()\n\n  return {\n    top: box.top + window.pageYOffset - document.documentElement.clientTop,\n    left: box.left + window.pageXOffset - document.documentElement.clientLeft\n  }\n}\n\n/**\n * 获取元素高度\n * @param  {HTMLElement} el DOM元素\n * @return {Number}         高度值\n */\nexport const getHeight = (el) => {\n  let styles = getStyle(el)\n  let height = el.offsetHeight\n  let borderTopWidth = parseFloat(styles.borderTopWidth)\n  let borderBottomWidth = parseFloat(styles.borderBottomWidth)\n  let paddingTop = parseFloat(styles.paddingTop)\n  let paddingBottom = parseFloat(styles.paddingBottom)\n  return height - borderBottomWidth - borderTopWidth - paddingTop - paddingBottom\n}\n\n/**\n * 获取文档的 scrollTop\n * @return {Number} scroolTop 值\n */\nexport const getScrollTop = () => {\n  return (document.documentElement && document.documentElement.scrollTop) || document.body.scrollTop\n}\n","import { wrap, unwrap, getStyle, setStyle, getOffset, getHeight, getScrollTop } from './utils'\n\n/**\n * Pin 类\n */\nexport default class Pin {\n  /**\n   * 构造函数\n   * @param  {Element} el       DOM元素\n   * @param  {Object}  options  选项\n   * @return {Pin}              Pin实例\n   */\n  constructor (el, options) {\n    // 定义属性\n    this.$el = el\n    this.$win = window\n    this.scrollY = 0\n    this.elements = []\n    this.disabled = false\n    this.options = this.options || {}\n    this.data = {}\n\n    // 初始化\n    this._init()\n  }\n\n  /**\n   * 更新\n   */\n  update () {\n    this._recalculateLimits()\n    this._onScroll()\n  }\n\n  /**\n   * 初始化\n   */\n  _init () {\n    // 初始化 data\n    let data = this.data\n    if (!data.update) {\n      this.elements.push(this.$el)\n      Array.prototype.forEach.call(this.$el.getElementsByTagName('img'), item => {\n        item.addEventListener('load', () => {\n          this._recalculateLimits()\n          this.removeEventListener('load')\n        })\n      })\n      data.update = this.update\n      this.data = data\n    }\n\n    // 监听事件\n    this.$win.addEventListener('scroll', () => { this._onScroll() })\n    this.$win.addEventListener('resize', () => { this._recalculateLimits() })\n    this._recalculateLimits()\n    this.$win.addEventListener('load', () => { this.update() })\n  }\n\n  /**\n   * 计算状态值\n   */\n  _recalculateLimits () {\n    for (let i = 0, len = this.elements.length; i < len; i++) {\n      let $el = this.elements[i]\n\n      if (this.options.minWidth && this.$win.innerWidth <= this.options.minWidth) {\n        if ($el.parentNode.matches('.pin-wrapper')) { unwrap($el) }\n        setStyle($el, {width: '', left: '', top: '', position: ''})\n        if (this.options.activeClass) { $el.classList.remove(this.options.activeClass) }\n        this.disabled = true\n        continue\n      } else {\n        this.disabled = false\n      }\n\n      let $container = this.options.containerSelector ? $el.closest(this.options.containerSelector) : document.body\n      let offset = getOffset($el)\n      let containerOffset = getOffset($container)\n      let parentOffset = getOffset($el.offsetParent)\n\n      if (!$el.parentNode.matches('.pin-wrapper')) {\n        let warpEl = document.createElement('div')\n        warpEl.className = 'pin-wrapper'\n        wrap($el, warpEl)\n      }\n\n      let pad = Object.assign({}, {\n        top: 0,\n        bottom: 0\n      }, this.options.padding || {})\n      let data = {\n        pad: pad,\n        from: offset.top - pad.top,\n        // from: (this.options.containerSelector ? offset.top : offset.top) - pad.top,\n        to: containerOffset.top + getHeight($container) - $el.clientHeight - pad.bottom,\n        end: containerOffset.top + getHeight($container),\n        parentTop: parentOffset.top\n      }\n      this.data = data\n\n      setStyle($el, { width: $el.clientWidth })\n      setStyle($el.parentNode, { height: $el.clientHeight })\n    }\n  }\n\n  /**\n   * 滚动事件处理方法\n   */\n  _onScroll () {\n    if (this.disabled) { return }\n\n    this.scrollY = getScrollTop()\n\n    let elmts = []\n    for (let i = 0, len = this.elements.length; i < len; i++) {\n      let $el = this.elements[i]\n      let data = this.data\n\n      if (!data) continue\n\n      elmts.push($el)\n\n      let from = data.from - data.pad.bottom\n      let to = data.to - data.pad.top\n\n      if (from + $el.clientHeight > data.end) {\n        $el.style.position = ''\n        continue\n      }\n\n      if (scrollY > from && scrollY < to) {\n        if (!(getStyle($el, 'position') === 'fixed')) {\n          setStyle($el, {\n            left: getOffset($el).left,\n            top: data.pad.top,\n            position: 'fixed'\n          })\n        }\n        if (this.options.activeClass) { $el.classList.add(this.options.activeClass) }\n      } else if (scrollY >= to) {\n        setStyle($el, {\n          left: '',\n          top: to - data.parentTop + data.pad.top,\n          position: 'absolute'\n        })\n        if (this.options.activeClass) { $el.classList.add(this.options.activeClass) }\n      } else {\n        setStyle($el, {\n          left: '',\n          top: '',\n          position: ''\n        })\n        if (this.options.activeClass) { $el.classList.remove(this.options.activeClass) }\n      }\n    }\n    this.elements = elmts\n  }\n}\n","import Pin from './src/Pin'\n\n/**\n * 指令选项\n * @type {Object}\n */\nPin.directiveOptions = {\n  inserted: function (el, options) {\n    Pin.create(el, options.value)\n  },\n  componentUpdated: function (el, options) {\n    setTimeout(() => { Pin.create(el, options.value) }, 500)\n  }\n}\n\n/**\n * 注入 Vue 插件安装器\n * @param  {Object} Vue        Vue 框架对象\n * @param  {Object} options    use 选项\n */\nPin.install = function (Vue, options) {\n  // 注册 vue 指令\n  Vue.directive('pin', Pin.directiveOptions)\n}\n\n/**\n * 快捷创建\n * @param  {Element} el     DOM元素\n * @param  {Options} options 选项\n * @return {Pin}     pin 实例\n */\nPin.create = function (el, options) {\n  return new Pin(el, options)\n}\n\n// export\nexport default Pin\n"],"names":["wrap","el","wrapEl","wrapper","document","createElement","parentNode","insertBefore","removeChild","appendChild","unwrap","prototype","forEach","call","childNodes","child","getStyle","key","styles","ownerDocument","defaultView","getComputedStyle","setStyle","value","join","style","getOffset","top","left","box","getBoundingClientRect","window","pageYOffset","documentElement","clientTop","pageXOffset","clientLeft","getHeight","height","offsetHeight","borderTopWidth","parseFloat","borderBottomWidth","paddingTop","paddingBottom","getScrollTop","scrollTop","body","Pin","options","$el","$win","scrollY","elements","disabled","data","_init","_recalculateLimits","_onScroll","update","push","getElementsByTagName","addEventListener","removeEventListener","i","len","length","minWidth","innerWidth","matches","width","position","activeClass","classList","remove","$container","containerSelector","closest","offset","containerOffset","parentOffset","offsetParent","warpEl","className","pad","Object","assign","padding","clientHeight","bottom","clientWidth","elmts","from","to","end","add","parentTop","directiveOptions","create","install","Vue","directive"],"mappings":"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"}