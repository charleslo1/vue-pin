{"version":3,"file":"vue-pin.js","sources":["../src/utils.js","../src/Pin.js","../index.js"],"sourcesContent":["/**\n * 包裹 DOM 元素\n * @param  {HTMLElement} el      被包裹元素\n * @param  {HTMLElement} wrapEl  包裹元素\n */\nexport const wrap = (el, wrapEl) => {\n  let wrapper = wrapEl || document.createElement('div')\n  el.parentNode.insertBefore(wrapper, el)\n  el.parentNode.removeChild(el)\n  wrapper.appendChild(el)\n}\n/**\n * 取消包裹 DOM 元素\n * @param  {HTMLElement} el      需要取消包裹的元素\n */\nexport const unwrap = (el) => {\n  Array.prototype.forEach.call(el.childNodes, (child) => {\n    el.parentNode.insertBefore(child, el)\n  })\n  el.parentNode.removeChild(el)\n}\n\n/**\n * 获取样式\n * @param  {HTMLElement} el  DOM 元素\n * @param  {String}      key 样式键（可选）\n * @return {String/Object}   样式值/样式表\n */\nexport const getStyle = (el, key) => {\n  let styles = el.ownerDocument.defaultView.getComputedStyle(el, null)\n  if (key) return styles[key]\n  return styles\n}\n\n/**\n * 设置样式\n * @param  {HTMLElement} el     DOM 元素\n * @param  {Object}      styles 样式表\n */\nexport const setStyle = (el, styles) => {\n  let value = null\n  for (let key in styles) {\n    value = styles[key]\n    if (typeof value === 'number') {\n      value = [value, 'px'].join('')\n    }\n    el.style[key] = value\n  }\n}\n\n/**\n * 获取元素 offset\n * @param  {HTMLElement} el DOM元素\n * @return {Object}         offset 值\n */\nexport const getOffset = (el) => {\n  if (!el) return {top: 0, left: 0}\n  let box = el.getBoundingClientRect()\n\n  return {\n    top: box.top + window.pageYOffset - document.documentElement.clientTop,\n    left: box.left + window.pageXOffset - document.documentElement.clientLeft\n  }\n}\n\n/**\n * 获取元素高度\n * @param  {HTMLElement} el DOM元素\n * @return {Number}         高度值\n */\nexport const getHeight = (el) => {\n  let styles = getStyle(el)\n  let height = el.offsetHeight\n  let borderTopWidth = parseFloat(styles.borderTopWidth)\n  let borderBottomWidth = parseFloat(styles.borderBottomWidth)\n  let paddingTop = parseFloat(styles.paddingTop)\n  let paddingBottom = parseFloat(styles.paddingBottom)\n  return height - borderBottomWidth - borderTopWidth - paddingTop - paddingBottom\n}\n\n/**\n * 获取文档的 scrollTop\n * @return {Number} scroolTop 值\n */\nexport const getScrollTop = () => {\n  return (document.documentElement && document.documentElement.scrollTop) || document.body.scrollTop\n}\n","import { wrap, unwrap, getStyle, setStyle, getOffset, getHeight, getScrollTop } from './utils'\n\n/**\n * Pin 类\n */\nexport default class Pin {\n  /**\n   * 构造函数\n   * @param  {Element} el       DOM元素\n   * @param  {Object}  options  选项\n   * @return {Pin}              Pin实例\n   */\n  constructor (el, options) {\n    // 定义属性\n    this.$el = el\n    this.$win = window\n    this.scrollY = 0\n    this.elements = []\n    this.disabled = false\n    this.options = options || {}\n    this.data = {}\n\n    // 将 Pin 实例绑定到元素，以便可手动触发 update\n    el.pin = this\n\n    // 初始化\n    this._init()\n  }\n\n  /**\n   * 更新\n   */\n  update () {\n    this._recalculateLimits()\n    this._onScroll()\n  }\n\n  /**\n   * 初始化\n   */\n  _init () {\n    // 初始化 data\n    let data = this.data\n    if (!data.update) {\n      this.elements.push(this.$el)\n      Array.prototype.forEach.call(this.$el.getElementsByTagName('img'), item => {\n        item.addEventListener('load', () => {\n          this._recalculateLimits()\n          this.removeEventListener('load')\n        })\n      })\n      data.update = this.update\n      this.data = data\n    }\n\n    // 监听事件\n    this.$win.addEventListener('scroll', () => { this._onScroll() })\n    this.$win.addEventListener('resize', () => { this._recalculateLimits() })\n    this._recalculateLimits()\n    this.$win.addEventListener('load', () => { this.update() })\n  }\n\n  /**\n   * 计算状态值\n   */\n  _recalculateLimits () {\n    for (let i = 0, len = this.elements.length; i < len; i++) {\n      let $el = this.elements[i]\n\n      if (this.options.minWidth && this.$win.innerWidth <= this.options.minWidth) {\n        if ($el.parentNode.matches('.pin-wrapper')) { unwrap($el) }\n        setStyle($el, {width: '', left: '', top: '', position: ''})\n        if (this.options.activeClass) { $el.classList.remove(this.options.activeClass) }\n        this.disabled = true\n        continue\n      } else {\n        this.disabled = false\n      }\n\n      let $container = this.options.containerSelector ? $el.closest(this.options.containerSelector) : document.body\n      let offset = getOffset($el)\n      let containerOffset = getOffset($container)\n      let parentOffset = getOffset($el.offsetParent)\n\n      if (!$el.parentNode.matches('.pin-wrapper')) {\n        let warpEl = document.createElement('div')\n        warpEl.className = 'pin-wrapper'\n        wrap($el, warpEl)\n      }\n\n      let pad = Object.assign({}, {\n        top: 0,\n        bottom: 0\n      }, this.options.padding || {})\n      let data = {\n        pad: pad,\n        // from: offset.top - pad.top,\n        from: (this.options.containerSelector ? containerOffset.top : offset.top) - pad.top,\n        to: containerOffset.top + getHeight($container) - $el.clientHeight - pad.bottom,\n        end: containerOffset.top + getHeight($container),\n        parentTop: parentOffset.top\n      }\n      this.data = data\n\n      setStyle($el, { width: $el.clientWidth })\n      setStyle($el.parentNode, { height: $el.clientHeight })\n    }\n  }\n\n  /**\n   * 滚动事件处理方法\n   */\n  _onScroll () {\n    if (this.disabled) { return }\n\n    this.scrollY = getScrollTop()\n\n    let elmts = []\n    for (let i = 0, len = this.elements.length; i < len; i++) {\n      let $el = this.elements[i]\n      let data = this.data\n\n      if (!data) continue\n\n      elmts.push($el)\n\n      let from = data.from - data.pad.bottom\n      let to = data.to - data.pad.top\n\n      if (from + $el.clientHeight > data.end) {\n        $el.style.position = ''\n        continue\n      }\n\n      if (scrollY > from && scrollY < to) {\n        if (!(getStyle($el, 'position') === 'fixed')) {\n          setStyle($el, {\n            left: getOffset($el).left,\n            top: data.pad.top,\n            position: 'fixed'\n          })\n        }\n        if (this.options.activeClass) { $el.classList.add(this.options.activeClass) }\n      } else if (scrollY >= to) {\n        setStyle($el, {\n          left: '',\n          top: to - data.parentTop + data.pad.top,\n          position: 'absolute'\n        })\n        if (this.options.activeClass) { $el.classList.add(this.options.activeClass) }\n      } else {\n        setStyle($el, {\n          left: '',\n          top: '',\n          position: ''\n        })\n        if (this.options.activeClass) { $el.classList.remove(this.options.activeClass) }\n      }\n    }\n    this.elements = elmts\n  }\n}\n","import Pin from './src/Pin'\n\n/**\n * 指令选项\n * @type {Object}\n */\nPin.directiveOptions = {\n  inserted: function (el, options) {\n    Pin.create(el, options.value)\n  },\n  componentUpdated: function (el, options) {\n    setTimeout(() => { Pin.create(el, options.value) }, 500)\n  }\n}\n\n/**\n * 注入 Vue 插件安装器\n * @param  {Object} Vue        Vue 框架对象\n * @param  {Object} options    use 选项\n */\nPin.install = function (Vue, options) {\n  // 注册 vue 指令\n  Vue.directive('pin', Pin.directiveOptions)\n}\n\n/**\n * 快捷创建\n * @param  {Element} el     DOM元素\n * @param  {Options} options 选项\n * @return {Pin}     pin 实例\n */\nPin.create = function (el, options) {\n  return new Pin(el, options)\n}\n\n// export\nexport default Pin\n"],"names":["wrap","el","wrapEl","wrapper","document","createElement","parentNode","insertBefore","removeChild","appendChild","unwrap","prototype","forEach","call","childNodes","child","getStyle","key","styles","ownerDocument","defaultView","getComputedStyle","setStyle","value","join","style","getOffset","top","left","box","getBoundingClientRect","window","pageYOffset","documentElement","clientTop","pageXOffset","clientLeft","getHeight","height","offsetHeight","borderTopWidth","parseFloat","borderBottomWidth","paddingTop","paddingBottom","getScrollTop","scrollTop","body","Pin","options","$el","$win","scrollY","elements","disabled","data","pin","_init","_recalculateLimits","_onScroll","update","push","getElementsByTagName","addEventListener","removeEventListener","i","len","length","minWidth","innerWidth","matches","width","position","activeClass","classList","remove","$container","containerSelector","closest","offset","containerOffset","parentOffset","offsetParent","warpEl","className","pad","Object","assign","padding","clientHeight","bottom","clientWidth","elmts","from","to","end","add","parentTop","directiveOptions","create","install","Vue","directive"],"mappings":"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"}